local zname = 
{
{'Alzadaal_Undersea_Ruins', 'Vidmapire',               6389, 128, 3},
{'Attohwa_Chasm',           'Muut',                    6358, 125, 3},
{'Aydeewa_Subterrane',      'Tumult_Curator',          6479, 145, 5},
{'Batallia_Downs',          'Lumber_Jill',             6323, 125, 3},
{'Beaucedine_Glacier',      'Largantua',               6328, 125, 3},
{'Behemoths_Dominion',      'Sovereign_Behemoth',      6405, 135, 4},
{'Bibiki_Bay',              'Intuila',                 6320, 119, 2},
{'Bostaunieux_Oubliette',   'Garbage_Gel',             6382, 122, 3},
{'Buburimu_Peninsula',      'Abyssdiver',              6319, 119, 2},
{'Caedarva_Mire',           'Shedu',                   6482, 135, 4},
{'Cape_Teriggan',           'Vedrfolnir',              6354, 128, 3},
{'Carpenters_Landing',      'Orcfeltrap',              6322, 119, 2},
{'Den_of_Rancor',           'Azrael',                  6365, 128, 3},
{'East_Ronfaure',           'Hugemaw_Harold',          6312,  75, 1},
{'East_Sarutabaruta',       'Prickly_Pitriv',          6314,  75, 1},
{'Eastern_Altepa_Desert',   'Cactrot_Veloz',           6331, 122, 3},
{'FeiYin',                  'Borealis_Shadow',         6366, 128, 3},
{'Garlaige_Citadel',        'Mephitas',                6361, 125, 3},
{'Gustav_Tunnel',           'Wyvernhunter_Bambrox',    6485, 128, 3},
{'Ifrits_Cauldron',         'Coca',                    6362, 125, 3},
{'Jugner_Forest',           'Emperor_Arthro',          6321, 125, 3},
{'Konschtat_Highlands',     'Sleepy_Mabel',            6316,  99, 1},
{'Kuftal_Tunnel',           'Specter_Worm',            6364, 125, 3},
{'La_Theine_Plateau',       'Ironhorn_Baldurno',       6315,  99, 1},
{'Labyrinth_of_Onzozo',     'Voso',                    6360, 122, 3},
{'Lufaise_Meadows',         'Immanibugard',            6357, 119, 2},
{'Meriphataud_Mountains',   'Warblade_Beak',           6326, 122, 3},
{'Misareaux_Coast',         'Tiyanak',                 6356, 122, 3},
{'Mount_Zhayolm',           'Grand_Grenade',           6388, 128, 3},
{'Pashhow_Marshlands',      'Joyous_Green',            6324, 122, 3},
{'Qufim_Island',            'Jester_Malatrix',         6330, 119, 2},
{'Quicksand_Caves',         'Centurio_XX-I',           6390, 125, 3},
{'RoMaeve',                 'Douma_Weapon',            6352, 125, 3},
{'Rolanberry_Fields',       'Strix',                   6325, 125, 3},
{'Sauromugue_Champaign',    'Arke',                    6327, 125, 3},
{'Sea_Serpent_Grotto',      'Bakunawa',                6383, 125, 3},
{'South_Gustaberg',         'Bounding_Belinda',        6313,  75, 1},
{'Tahrongi_Canyon',         'Serpopard_Ninlil',        6318,  99, 1},
{'Temple_of_Uggalepih',     'Azure-toothed_Clawberry', 6384, 125, 3},
{'The_Boyahda_Tree',        'Ayapec',                  6363, 125, 3},
{'The_Sanctuary_of_ZiTah',  'Keeper_of_Heiligtum',     6351, 122, 3},
{'Uleguerand_Range',        'Camahueto',               6359, 128, 3},
{'Valkurm_Dunes',           'Valkurm_Imperator',       6317, 119, 2},
{'Valley_of_Sorrows',       'Tolba',                   6403, 135, 4},
{'Wajaom_Woodlands',        'Kubool_Jas_Mhuufya',      6387, 125, 3},
{'Western_Altepa_Desert',   'King_Uropygid',           6353, 125, 3},
{'Xarcabard',               'Beist',                   6329, 125, 3},
{'Yhoator_Jungle',          'Woodland_Mender',         6332, 122, 3},
{'Yuhtunga_Jungle',         'Sybaritic_Samantha',      6350, 119, 2},
{'Lufaise_Meadows',         'Vermillion_Fishfly',      6385, 125, 3},
{'FeiYin',                  'Carousing_Celine',        6484, 128, 3},
{'Misareaux_Coast',         'Volatile_Cluster',        6386, 128, 3},
{'Cape_Teriggan',           'Glazemane',               6483, 128, 3},
{'The_Boyahda_Tree',        'Hidhaegg',                6404, 135, 4},
{'Wajaom_Woodlands',        'Thuban',                  6480, 135, 4},
{'Mount_Zhayolm',           'Sarama',                  6481, 135, 4},
}

local coffer =
{
{'tolbas_coffer'},
{'muuts_coffer'},
{'hugemaw_harolds_coffer'},
{'bounding_belindas_coffer'},
{'prickly_pitrivs_coffer'},
{'ironhorn_baldurnos_coffer'},
{'sleepy_mabels_coffer'},
{'valkurm_imperators_coffer'},
{'serpopard_ninlils_coffer'},
{'abyssdivers_coffer'},
{'intuilas_coffer'},
{'emperor_arthros_coffer'},
{'orcfeltraps_coffer'},
{'lumber_jills_coffer'},
{'joyous_greens_coffer'},
{'strixs_coffer'},
{'warblade_beaks_coffer'},
{'arkes_coffer'},
{'largantuas_coffer'},
{'beists_coffer'},
{'jester_malatrixs_coffer'},
{'catrot_velozs_coffer'},
{'woodland_menders_coffer'},
{'sybaritic_samanthas_coffer'},
{'keeper_of_heiligtums_coffer'},
{'douma_weapons_coffer'},
{'king_uropygids_coffer'},
{'vedrfolnirs_coffer'},
{'tiyanaks_coffer'},
{'immanibugards_coffer'},
{'muuts_coffer'},
{'camahuetos_coffer'},
{'vosos_coffer'},
{'mephitass_coffer'},
{'cocas_coffer'},
{'ayapecs_coffer'},
{'specter_worms_coffer'},
{'azraels_coffer'},
{'borealis_shadows_coffer'},
{'hidhaeggs_coffer'},
{'sovereign_behemoths_coffer'},
{'garbage_gels_coffer'},
{'bakunawas_coffer'},
{'azure-toothed_clawberrys_coffer'},
{'vermillion_fishflys_coffer'},
{'volatile_clusters_coffer'},
{'mhuufyas_coffer'},
{'grand_grenades_coffer'},
{'vidmapires_coffer'},
{'centurio_xx-is_coffer'},
{'tumult_curators_coffer'},
{'thubans_coffer'},
{'saramas_coffer'},
{'shedus_coffer'},
{'glazemanes_coffer'},
{'carousing_celines_coffer'},
{'bambroxs_coffer'},
}


local ensureTable = function(str)
    local parts = utils.splitStr(str, '.')
    local table = _G;
    for _, part in ipairs(parts) do
        table[part] = table[part] or {}
        table = table[part]
    end
end
for _, entry in pairs(zname) do
    ensureTable(string.format('xi.zones.%s.npcs.Ethereal_Junction', entry[1]))
end
for _, entry in pairs(zname) do
    ensureTable(string.format('xi.zones.%s.mobs.%s', entry[1], entry[2]))
end
for _, entry in pairs(coffer) do
    ensureTable(string.format('xi.items.%s', entry[1]))
end

-----------------------------------
require("modules/module_utils")
require("scripts/globals/npc_util")
require("scripts/globals/unitywanted")
-----------------------------------

local m = Module:new("unitybattle")


for _, entry in pairs(zname) do
m:addOverride(string.format("xi.zones.%s.npcs.Ethereal_Junction.onTrigger",entry[1]), function(player, npc)
xi.unitywanted.qmOnTrigger(player, npc)
end)
end

for _, entry in pairs(zname) do
m:addOverride(string.format("xi.zones.%s.npcs.Ethereal_Junction.onEventUpdate",entry[1]), function(player, csid, option, npc)

local zonez = player:getZoneID()
if zonez == 113 or 204 or 24 or 25 or 61 or 153 or 51 then
xi.unitywanted.qmOnEventUpdate(player, csid, option, npc)
end

end)
end

for _, entry in pairs(zname) do
m:addOverride(string.format("xi.zones.%s.npcs.Ethereal_Junction.onEventFinish", entry[1]), function(player, csid, option, npc, trade)
xi.unitywanted.qmOnEventFinish(player, npc, mob, option)
end)
end

for _, entry in pairs(zname) do
m:addOverride(string.format("xi.zones.%s.mobs.%s.onMobInitialize", entry[1], entry[2]), function(mob)
end)

m:addOverride(string.format("xi.zones.%s.mobs.%s.onMobSpawn", entry[1], entry[2]), function(mob)
                 mob:setMobMod(xi.mobMod.IDLE_DESPAWN, 15)
                 mob:setLocalVar('Unity_Time', os.time() + 900)
end)

m:addOverride(string.format("xi.zones.%s.mobs.%s.onMobDeath", entry[1], entry[2]), function(mob, player, params, npc)
    local party = player:getParty()
                     for _, partyMemeber in pairs(party) do
        player:delStatusEffect(xi.effect.BATTLEFIELD)
        player:countdown()
        npcUtil.giveItem(player, {{4061, entry[5]}})
        npcUtil.giveItem(player, {{entry[3], 1}})
                     end
end)

m:addOverride(string.format("xi.zones.%s.mobs.%s.onMobDespawn", entry[1], entry[2]), function(mob, player, params, npc)

end)

m:addOverride(string.format("xi.zones.%s.mobs.%s.onMobFight", entry[1], entry[2]), function(mob, player, params, npc)
    local timeLeft = mob:getLocalVar('Unity_Time') - os.time()
    local party = player:getParty()

    if timeLeft <= 0 or
       not player:hasStatusEffect(xi.effect.BATTLEFIELD) then
                 for _, partyMemeber in pairs(party) do
       player:delStatusEffect(xi.effect.BATTLEFIELD)
       player:countdown()
       end
       DespawnMob(mob:getID())
    end
end)
end

----------------------coffers------------------------------------------
-----------------------------------------------------------------------

for _, entry in pairs(coffer) do
m:addOverride(string.format("xi.items.%s.onItemCheck", entry[1]), function(target)
    return xi.itemUtils.itemBoxOnItemCheck(target)
end)

m:addOverride(string.format("xi.items.%s.onItemUse", entry[1]), function(target)
        target:addItem(xi.item.GALKAN_SAUSAGE, 1)
        target:messageSpecial(zones[target:getZoneID()].text.ITEM_OBTAINED, 4395)
end)
end







return m